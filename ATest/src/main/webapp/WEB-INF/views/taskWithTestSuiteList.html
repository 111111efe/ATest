<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title></title>
<link href="css/all.css" rel="stylesheet" type="text/css">
<link href="js/editor/css/font-awesome.min.css" rel="stylesheet"
	type="text/css">
<link href="js/editor/css/froala_editor.min.css" rel="stylesheet"
	type="text/css">
<link href="js/editor/css/input-autocomplete.css" rel="stylesheet" />
<style>
.input-default {
	padding: 5px;
	border: 1px solid #ccc;
	border-radius: 2px; /*html5*/
	text-indent: 0 !important;
	min-height: 22px;
}
</style>

</head>

<body style="background-color: #e6ecf5">

	<div class="book_con01">
		<h1 class="book_h01">测试集管理</h1>
		<p class="book_p">
		<form id="form_addOrUpdate" method="post">
			<table id="edit_book" class="book_table" border="1" cellpadding="10">
				<tr>
					<input id="taskId" type="hidden" name="taskId" />
					<td><label class="td_label">任务名</label></td>
					<td colspan="5"><label id="taskName" class="td_label"></label></td>
					</td>
				</tr>
				<tr id="tr_testcase">
					<input id="id" name="id" type="hidden"" />
					<td><label class="td_label">测试集号</label></td>
					<td><input id="testSuiteId" name="testSuiteId"
						type="text" class="book_input03" " autocomplete="off"></label></td>
					<td><label class="td_label">测试集名</label></td>
					<td><input id="testSuiteName" name="testSuiteName"
						type="text" class="book_input03" autocomplete="off"></td>
					<td><label class="td_label">优先级</label></td>
					<td><input id="priority" name="priority" type="text"
						class="book_input03"></td>
				</tr>
			</table>
			<p class="book_foot">
				<input type="button" id="addSuite" value="添加测试集" /><input
					type="button" id="updateSuite" value="保存修改" style="display: none" />
					<input
					type="button" id="cancel" value="取消" style="display: none" />
			</p>
		</form>
		<div
			style="overflow-x: auto; overflow-y: auto; height: 251px; width: 100%;">
			<table id="table" class="book_table" border="1" cellpadding="10">
				<tr>
					<td><label class="td_label">优先级</label></td>
					<td><label class="td_label">测试集号</label></td>
					<td><label class="td_label">测试集名</label></td>
					<td><label class="td_label">操作</label></td>
				</tr>
			</table>
		</div>

		</p>


	</div>
	<script src="js/jquery/jQuery-2.2.0.min.js"></script>
	<script src="js/editor/js/input-autocomplete.js"></script>

	<script>
		$(function() {
			let url = decodeURI(window.location.search);
			let value;
			if (url.indexOf("?") != -1) {
				let strs = url.substr(1).split("&");
				value = new Array(strs.length);
				for (let i = 0; i < strs.length; i++) {
					value[i] = unescape(strs[i].split("=")[1]);
				}
			}
			$("#taskId").val(value[0]);
			$("#taskName").text(value[1]);
			
			$.ajax({
						type : 'post',
						url : "toQueryTaskWithTestSuites",
						cache : false,
						data : {
							"taskId" : $("#taskId").val()
						},
						success : function(data) {
							let arr = data.testSuiteWithCases;
							for (let i = 0; i < arr.length; i++) {
								$("#table")
										.append(
												"<tr id='"
														+ (i + 1)
														+ "'><input id='id"
														+ (i + 1)
														+ "' type='hidden' name='id"
														+ (i + 1)
														+ "' value='"
														+ arr[i].id
														+ "' /><td><label id='priority"
														+ (i + 1)
														+ "' class='td_label'>"
														+ arr[i].priority
														+ "</label></td><td><label id='testSuiteId"
														+ (i + 1)
														+ "' class='td_label'>"
														+ arr[i].testSuiteId
														+ "</label></td><td><label id='testSuiteName"
														+ (i + 1)
														+ "' class='td_label'>"
														+ arr[i].testSuiteName
														+ "</label></td><td><a href='javascript:void(0)' onclick='EditElement("
														+ (i + 1)
														+ ")' class='add_a'>编辑</a><a href='javascript:void(0)' onclick='DeleteElement("
														+ (i + 1)
														+ ")' class='add_a'>删除</a></td></tr>");
							}
						},
						error : function() {
							alert("查询失败")
						}
					})
		});
	</script><script>
		$("#addSuite").click(function() {
			let targetUrl = "toAddTaskWithTestSuite";
			let data = $('#form_addOrUpdate').serialize();
			$.ajax({
				type : 'post',
				url : targetUrl,
				cache : false,
				data : data,
				dataType : 'json',
				success : function(data) {
					if (data) {
						alert("提交成功");
						location.reload();
					} else
						alert("数据错误");
				},
				error : function() {
					alert("提交失败");
				}
			})

		});

		$("#updateSuite").click(function() {
			let targetUrl = "toUpdateTaskWithTestSuite";
			let data = $('#form_addOrUpdate').serialize();
			$.ajax({
				type : 'post',
				url : targetUrl,
				cache : false,
				data : data,
				dataType : 'json',
				success : function(data) {
					if (data) {
						alert("提交成功");
						$("#updateSuite").hide();
						$("#cancel").hide();
						$("#addSuite").show();
						location.reload();
					} else
						alert("数据错误");
				},
				error : function() {
					alert("提交失败");
				}
			})

		});
		$("#cancel").click(function() {
			$("#id").val('');
			$("#testSuiteId").val('');
			$("#testSuiteName").val('');
			$("#priority").val('');
			$("#updateSuite").hide();
			$("#cancel").hide();
			$("#addSuite").show();
		})
	</script>
	<script>
		function DeleteElement(index) {
			$
					.ajax({
						type : 'post',
						url : "toDelTaskWithTestSuite",
						cache : false,
						data : {
							"id" : $("#id" + index).val()
						},
						success : function(data) {
							if (data) {
								let _len = $("#table tr").length;
								$("tr[id='" + index + "']").remove();//删除当前行
								for (let i = index + 1, j = _len; i < j; i++) {
									let nextIdVal = $("#id" + i).val();
									let nextTestSuiteIdVal = $(
											"#testSuiteId" + i).text();
									let nextITestSuiteNameVal = $(
											"#testSuiteName" + i).text();
									let nextPriorityVal = $("#priority" + i)
											.text();
									$("tr[id=\'" + i + "\']")
											.replaceWith(
													"<tr id='"
															+ (i - 1)
															+ "'><input id='id"
															+ (i - 1)
															+ "' type='hidden' name='id"
															+ (i - 1)
															+ "' value='"
															+ nextIdVal
															+ "' /><td><label id='priority"
															+ (i - 1)
															+ "' class='td_label'>"
															+ nextPriorityVal
															+ "</label></td><td><label id='testSuiteId"
															+ (i - 1)
															+ "' class='td_label'>"
															+ nextTestSuiteIdVal
															+ "</label></td><td><label id='testSuiteName"
															+ (i - 1)
															+ "' class='td_label'>"
															+ nextITestSuiteNameVal
															+ "</label></td><td><a href='javascript:void(0)' onclick='EditElement("
															+ (i - 1)
															+ ")' class='add_a'>编辑</a><a href='javascript:void(0)' onclick='DeleteElement("
															+ (i - 1)
															+ ")' class='add_a'>删除</a></td></tr>");
								}
							} else
								alert("数据错误");
						},
						error : function() {
							alert("提交失败");
						}
					})
		}
	</script>
	<script>
		function EditElement(index) {
			$("#id").val($("#id" + index).val());
			$("#testSuiteId").val($("#testSuiteId" + index).text());
			$("#testSuiteName").val($("#testSuiteName" + index).text());
			$("#priority").val($("#priority" + index).text());
			$("#updateSuite").show();
			$("#cancel").show();
			$("#addSuite").hide();

		}
	</script>
		
	<script>
		$("#testSuiteName").bigAutocomplete({
			url : 'queryTestSuiteByName',
			title : 'name',
			custom : false,
			formatItem : function(data, i, row) {
				return row.name + " " + row.id;
			},
			formatSelected : function(data, i, row) {
				return row.name;
			},
			callback : function(row) {
				if (null != row) {
					$("#testSuiteId").val(row.id);
				}
			},
		});

		$("#testSuiteId").bigAutocomplete({
			url : 'queryTestSuiteById',
			title : 'name',
			custom : false,
			formatItem : function(data, i, row) {
				return row.id + " " + row.name;
			},
			formatSelected : function(data, i, row) {
				return row.id;
			},
			callback : function(row) {
				if (null != row) {
					$("#testSuiteName").val(row.name);
				}
			},
		});
	</script>
</body>
</html>
